/**
 * CategoryClassifier.ts
 * 가맹점명 기반 자동 카테고리 분류 서비스 (API 비용 0원)
 */

// 카테고리 정의
export type ExpenseCategory =
    | '카페'
    | '쇼핑'
    | '편의점'
    | '배달'
    | '식당'
    | '마트'
    | '문화'
    | '교통'
    | '통신'
    | '구독'
    | '의료'
    | '뷰티'
    | '교육'
    | '여행'
    | '주유'
    | '공과금'
    | '은행'
    | '기타';

// 카테고리별 키워드 매핑
const CATEGORY_KEYWORDS: Record<ExpenseCategory, string[]> = {
    '카페': [
        // 대형 프랜차이즈
        '스타벅스', '메가커피', '메가엠지씨', '투썸플레이스', '투썸', '컴포즈커피', '컴포즈',
        '빽다방', '이디야', '파스쿠찌', '커피빈', '할리스', '폴바셋',
        '더벤티', '엔제리너스', '하삼동커피', '탐앤탐스', '매머드커피',
        '카페베네', '감성커피', '달콤커피', '드롭탑', '셀렉토커피',
        '커피베이', '커피에반하다', '커피스미스', '커피명가', '만랩커피',
        '커피나무', '더카페', '토프레소', '커피마마', '그라찌에',
        '전광수커피', '빈스빈스', '카페보니또', '더착한커피', '공차',
        // 일반 키워드
        '카페', 'cafe', 'coffee', '커피', '라떼', '아메리카노',
        '블루보틀', '앤티앤스', '던킨', '크리스피크림', '베이커리'
    ],

    '쇼핑': [
        // 온라인
        '쿠팡', '11번가', 'G마켓', '지마켓', 'SSG', '옥션', '위메프',
        '티몬', '무신사', '29CM', '에이블리', '지그재그', '브랜디',
        '오늘의집', '마켓컬리', '컬리', '네이버쇼핑', '카카오쇼핑',
        '알리익스프레스', '알리', '테무', '아마존', '이베이',
        // 홈쇼핑
        'GS SHOP', 'CJ온스타일', '현대홈쇼핑', '롯데홈쇼핑', 'NS홈쇼핑',
        // 백화점
        '롯데백화점', '현대백화점', '신세계백화점', '갤러리아', 'AK플라자',
        // 아울렛
        '롯데아울렛', '신세계아울렛', '현대아울렛', '프리미엄아울렛',
        // 일반
        '다이소', '아트박스', '핫트랙스', '교보문고', '영풍문고', '알라딘'
    ],

    '편의점': [
        'GS25', '지에스25', 'CU', '씨유', '세븐일레븐', '7-ELEVEN',
        '이마트24', '미니스톱', '스토리웨이', 'WITH ME', '이마트에브리데이',
        'GS THE FRESH'
    ],

    '배달': [
        '배달의민족', '배민', '요기요', '쿠팡이츠', '땡겨요',
        '위메프오', '카카오톡주문', '네이버주문', '배달통'
    ],

    '식당': [
        // 패스트푸드
        '맥도날드', '버거킹', '롯데리아', 'KFC', '맘스터치', '노브랜드버거',
        '파파이스', '서브웨이', '쉐이크쉑',
        // 치킨
        'BHC', 'BBQ', '교촌', '굽네치킨', '푸라닭', '처갓집', '60계', '네네치킨',
        '호식이두마리', '지코바', 'bhc', '페리카나', '파파존스',
        // 피자
        '도미노피자', '피자헛', '미스터피자', '파파존스', '피자스쿨', '반올림피자',
        // 분식/한식
        '김밥천국', '본죽', '죽이야기', '한솥', '놀부', '원할머니보쌈',
        // 베이커리/디저트
        '파리바게뜨', '뚜레쥬르', '던킨도너츠', '크리스피크림', '배스킨라빈스',
        '베라', '롯데제과', '오리온', 'SPC',
        // 프랜차이즈
        '빕스', '아웃백', 'TGI', '애슐리', '세마을식당', '홍콩반점',
        '매드포갈릭', '베니건스', '스시로', '텐동', '규카츠'
    ],

    '마트': [
        '이마트', '홈플러스', '롯데마트', '코스트코', '트레이더스',
        '하나로마트', '농협마트', '메가마트', '킴스클럽',
        'GS더프레시', 'GS슈퍼', '롯데슈퍼', '이마트에브리데이'
    ],

    '문화': [
        // 영화
        'CGV', '메가박스', '롯데시네마', '씨네Q',
        // 공연/티켓
        '인터파크티켓', '예스24티켓', '멜론티켓', '티켓링크',
        // 놀이/게임
        '롯데월드', '에버랜드', '캐리비안베이', '오션월드',
        '코엑스', '방탈출', 'VR', '노래방', '코인노래방',
        'PC방', '볼링장', '당구장', '스크린골프', '골프존',
        // 음악/도서
        '멜론', '지니뮤직', '플로', 'FLO', '바이브', '벅스',
        '교보문고', '예스24', '알라딘', '밀리의서재',
        // 레저/서비스
        '골프존파크', '크린토피아', '다비치안경', '오토큐', 'AUTO Q'
    ],

    '교통': [
        // 택시
        '카카오택시', '타다', 'TADA', '우티', 'UT', '카카오T',
        // 버스/지하철
        '티머니', 'T-money', '캐시비', '레일플러스', '한페이',
        // 기차/항공
        '코레일', 'KTX', 'SRT', '대한항공', '아시아나', '제주항공',
        '진에어', '이스타', '티웨이', '에어부산', '에어서울',
        // 렌터카/주차
        '쏘카', '그린카', '카셰어링', '모두의주차장', '아이파킹',
        // 네비게이션
        '티맵', 'TMAP', 'T맵'
    ],

    '통신': [
        'SKT', 'SK텔레콤', 'KT', '엘지유플러스', 'LGU+', 'LG U+',
        '알뜰폰', '헬로모바일', 'KT엠모바일', 'SK세븐모바일',
        'SK브로드밴드', 'KT인터넷', 'LG인터넷'
    ],

    '구독': [
        // OTT
        '넷플릭스', 'Netflix', '티빙', 'TVING', '쿠팡플레이',
        '웨이브', 'WAVVE', '디즈니플러스', 'Disney+', '왓챠', 'WATCHA',
        '애플TV', 'Apple TV', '시즌', 'seezn',
        // 음악
        '멜론', 'Melon', '스포티파이', 'Spotify', '애플뮤직', 'Apple Music',
        '유튜브뮤직', 'YouTube Music', '지니', '플로', '벅스',
        // 기타
        '유튜브프리미엄', 'YouTube Premium', '밀리의서재', '리디북스',
        'Adobe', '마이크로소프트', 'Microsoft 365', '노션', 'Notion',
        '챗GPT', 'ChatGPT', 'OpenAI', '클라우드',
        '숏챠', 'SMR'
    ],

    '의료': [
        '약국', '병원', '의원', '치과', '안과', '피부과', '정형외과',
        '성형외과', '내과', '이비인후과', '소아과', '산부인과',
        '한의원', '한방', '물리치료', '재활', '건강검진',
        '올리브영', '랄라블라', '롭스', '부츠'
    ],

    '뷰티': [
        '올리브영', '아리따움', '이니스프리', '더페이스샵', '에뛰드',
        '미샤', '네이처리퍼블릭', '스킨푸드', '토니모리', '클리오',
        '헤어샵', '미용실', '네일', '왁싱', '피부관리', '스파', '마사지',
        '바버샵', '다이소뷰티'
    ],

    '교육': [
        '학원', '교습소', 'YBM', '파고다', '해커스', '메가스터디',
        '대성학원', '종로학원', '이투스', '스카이에듀', '에듀윌',
        '클래스101', '탈잉', '숨고', '크몽', '잔디',
        '듀오링고', 'Duolingo', '야나두', '시원스쿨',
        '잡코리아', '알바몬', '사람인'
    ],

    '여행': [
        // 예약
        '야놀자', '여기어때', '인터파크투어', '하나투어', '모두투어',
        '에어비앤비', 'Airbnb', '아고다', 'Agoda', '호텔스컴바인',
        '부킹닷컴', 'Booking.com', '익스피디아', '호텔스닷컴',
        '트립닷컴', '스카이스캐너', '마이리얼트립', '클룩', 'Klook',
        '트리플', 'NOL', '놀', '데일리호텔', '트리바고'
    ],

    '주유': [
        'SK에너지', 'GS칼텍스', 'S-OIL', '에쓰오일', 'HD현대오일뱅크',
        '오일뱅크', '알뜰주유소', '셀프주유', '충전소', '전기차충전',
        'T-station', '스피드메이트', '오토큐'
    ],

    '공과금': [
        // 전기/가스/수도
        '한국전력', '한전', 'KEPCO', '도시가스', '서울도시가스', '삼천리도시가스',
        '수도', '상하수도', '수도요금', '수도세',
        // 관리비
        '관리비', '아파트관리비', '월세', '임대료',
        // 기타
        '환경공단', 'TV수신료', '인터넷요금', '도시가스공사', '지역난방공사',
        'KBS', 'MBC', 'SBS', '케이블TV'
    ],

    '은행': [
        // 시중은행
        '신한은행', '국민은행', 'KB국민', '우리은행', '하나은행',
        'SC제일은행', '씨티은행', '대구은행', 'DGB', '부산은행', 'BNK',
        '광주은행', '전북은행', '경남은행', '제주은행',
        // 특수은행
        '농협', 'NH농협', '수협', '새마을금고', 'MG', '우체국', '저축은행',
        '산업은행', 'IBK', 'KDB', '수출입은행', '주택은행',
        // 인터넷은행
        '카카오뱅크', '토스뱅크', '케이뱅크', 'K뱅크', '신한솟', '카카오페이은행',
        // 카드사
        '삼성카드', '현대카드', '신한카드', 'KB카드', '우리카드', '하나카드',
        'BC카드', '롯데카드', 'NH카드', '씨티카드', '카카오카드'
    ],

    '기타': []
};

/**
 * 가맹점명으로 카테고리 자동 분류
 * @param merchantName 가맹점명
 * @returns 분류된 카테고리
 */
export function classifyMerchant(merchantName: string): ExpenseCategory {
    if (!merchantName) return '기타';

    const normalizedName = merchantName.toLowerCase().replace(/\s/g, '');

    for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
        for (const keyword of keywords) {
            const normalizedKeyword = keyword.toLowerCase().replace(/\s/g, '');
            if (normalizedName.includes(normalizedKeyword)) {
                return category as ExpenseCategory;
            }
        }
    }

    return '기타';
}

/**
 * 카테고리별 이모지 반환
 */
export function getCategoryEmoji(category: ExpenseCategory): string {
    const emojis: Record<ExpenseCategory, string> = {
        '카페': '☕',
        '쇼핑': '🛍️',
        '편의점': '🏪',
        '배달': '🛵',
        '식당': '🍽️',
        '마트': '🛒',
        '문화': '🎬',
        '교통': '🚗',
        '통신': '📱',
        '구독': '📺',
        '의료': '🏥',
        '뷰티': '💄',
        '교육': '📚',
        '여행': '✈️',
        '주유': '⛽',
        '공과금': '💸',
        '은행': '🏦',
        '기타': '📦'
    };
    return emojis[category] || '📦';
}

/**
 * 카테고리별 색상 반환
 */
export function getCategoryColor(category: ExpenseCategory): string {
    const colors: Record<ExpenseCategory, string> = {
        '카페': '#8B4513',
        '쇼핑': '#FF6B6B',
        '편의점': '#4ECDC4',
        '배달': '#FF9F43',
        '식당': '#FF6B6B',
        '마트': '#54A0FF',
        '문화': '#A855F7',
        '교통': '#3B82F6',
        '통신': '#10B981',
        '구독': '#EC4899',
        '의료': '#EF4444',
        '뷰티': '#F472B6',
        '교육': '#6366F1',
        '여행': '#14B8A6',
        '주유': '#F59E0B',
        '공과금': '#059669',
        '은행': '#0284C7',
        '기타': '#6B7280'
    };
    return colors[category] || '#6B7280';
}

// 모든 카테고리 목록 반환
export function getAllCategories(): ExpenseCategory[] {
    return Object.keys(CATEGORY_KEYWORDS) as ExpenseCategory[];
}
